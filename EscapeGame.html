<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js">
    </script>
    <meta charset="utf-8">
    <title>部屋から脱出せよ</title>
    <style>
      body{
        background-color: #ffffff;
      }
      label,button{
        color: #00000   0;
        font-family: Meiryo, Helvetica, sans-serif;
        font-size: 20px;
        margin-left: 40px;
      }
      input{
        color: #232F3E;
        font-family: Meiryo, Helvetica, sans-serif;
        font-size: 20px;
        margin-left: 40px;
      }
    </style>
  </head>
  <body>
    <p>部屋から脱出せよ</p>
    <div id="Situation1">
      <p><button type="button" onclick="selectChoice('0')">開始</button></p>
      <p>{{Situation}}</p>
      <button type="button" onclick="selectChoice('1')">{{Choice1}}</button>
      <button type="button" onclick="selectChoice('2')">{{Choice2}}</button>
      <p><button type="button" onclick="selectChoice('0')">リスタート</button></p>
    </div>
    <script>
      //vueインスタンス生成
        var vm = new Vue({
            el:'#Situation1',
            data:{
                ID:'0',
                Situation:'',
                Choice1:'開始を押してください',
                Choice2:'開始を押してください',
                Result:'',
                CorrectChoice:''
            }
        })
    //選択肢１、選択肢２、リスタートの条件分岐
        var selectChoice = (playerChoice)=>{
            if (playerChoice == '0') {
              vm.ID = 1;
              callAPI();
            } else if ((vm.CorrectChoice != '0') && (playerChoice == vm.CorrectChoice)) {
                vm.ID = vm.ID + 1;
                callAPI();
            } else if ((vm.CorrectChoice != '0') && (playerChoice != vm.CorrectChoice)) {
                vm.ID = 0;
                vm.Situation = vm.Result;
                vm.Choice1 = '';
                vm.Choice2 = '';
                vm.Result = '';
                vm.CorrectChoice = '0';
            }
        }
        var callAPI = ()=>{
            var id = vm.ID;
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            var raw = JSON.stringify({"ID":id});
            var requestOptions = {
              method: 'POST',
              headers: myHeaders,
              body: raw,
              redirect: 'follow'
            };
            fetch("https://24a2ldfcal.execute-api.us-east-1.amazonaws.com/dev", requestOptions)
            .then(response => response.text())
            .then(result => {
              vm.ID = JSON.parse(result).body['ID'];
              vm.Situation = JSON.parse(result).body['Situation'];
              vm.Choice1 = JSON.parse(result).body['Choice1'];
              vm.Choice2 = JSON.parse(result).body['Choice2'];
              vm.Result = JSON.parse(result).body['Result'];
              vm.CorrectChoice = JSON.parse(result).body['Correctchoice'];
              return 0;
            })
            .catch(error => console.log('error', error));
        }
    </script>
  </body>
</html>
(END)